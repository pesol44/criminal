<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Змейка</title>
    <style>
        body { text-align: center; font-family: Arial, sans-serif; background: #222; color: white; }
        canvas { background: black; display: none; touch-action: none; }
        #menu { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        button { font-size: 20px; padding: 10px 20px; margin-top: 20px; cursor: pointer; }
        #winMessage { display: none; font-size: 24px; margin-top: 10px; color: green; }
    </style>
</head>
<body>
    <div id="menu">
        <h1>Змейка</h1>
        <button onclick="startGame()">Играть</button>
    </div>
    
    <canvas id="gameCanvas"></canvas>
    <div id="winMessage">Поздравляем! Пароль: <b>chillguys</b></div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const size = 40; // Размер поля 40x40
        const tileSize = 10; // Размер одной клетки
        canvas.width = size * tileSize;
        canvas.height = size * tileSize;

        let snake, direction, food, gameInterval;

        function startGame() {
            document.getElementById("menu").style.display = "none";
            canvas.style.display = "block";
            snake = [{ x: 20, y: 20 }];
            direction = "RIGHT";
            food = spawnFood();
            document.addEventListener("keydown", changeDirection);
            setupTouchControls();
            gameInterval = setInterval(gameLoop, 100);
        }

        function changeDirection(event) {
            if (event.key === "ArrowUp" && direction !== "DOWN") direction = "UP";
            else if (event.key === "ArrowDown" && direction !== "UP") direction = "DOWN";
            else if (event.key === "ArrowLeft" && direction !== "RIGHT") direction = "LEFT";
            else if (event.key === "ArrowRight" && direction !== "LEFT") direction = "RIGHT";
        }

        function setupTouchControls() {
            let startX, startY;
            document.addEventListener("touchstart", e => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
            });

            document.addEventListener("touchmove", e => {
                if (!startX || !startY) return;
                let endX = e.touches[0].clientX;
                let endY = e.touches[0].clientY;
                let diffX = endX - startX;
                let diffY = endY - startY;

                if (Math.abs(diffX) > Math.abs(diffY)) {
                    if (diffX > 0 && direction !== "LEFT") direction = "RIGHT";
                    else if (diffX < 0 && direction !== "RIGHT") direction = "LEFT";
                } else {
                    if (diffY > 0 && direction !== "UP") direction = "DOWN";
                    else if (diffY < 0 && direction !== "DOWN") direction = "UP";
                }
                startX = startY = null;
            });
        }

        function spawnFood() {
            let newFood;
            do {
                newFood = { x: Math.floor(Math.random() * size), y: Math.floor(Math.random() * size) };
            } while (snake.some(segment => segment.x === newFood.x && segment.y === newFood.y));
            return newFood;
        }

        function update() {
            let head = { ...snake[0] };

            if (direction === "UP") head.y -= 1;
            if (direction === "DOWN") head.y += 1;
            if (direction === "LEFT") head.x -= 1;
            if (direction === "RIGHT") head.x += 1;

            // Проход сквозь стены
            if (head.x < 0) head.x = size - 1;
            if (head.x >= size) head.x = 0;
            if (head.y < 0) head.y = size - 1;
            if (head.y >= size) head.y = 0;

            if (snake.some(s => s.x === head.x && s.y === head.y)) {
                clearInterval(gameInterval);
                alert("Игра окончена!");
                location.reload();
                return;
            }

            snake.unshift(head);
            if (head.x === food.x && head.y === food.y) {
                food = spawnFood();
            } else {
                snake.pop();
            }

            if (snake.length === size * size) {
                clearInterval(gameInterval);
                document.getElementById("winMessage").style.display = "block";
            }
        }

        function draw() {
            ctx.fillStyle = "black";
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            ctx.fillStyle = "lime";
            snake.forEach(segment => ctx.fillRect(segment.x * tileSize, segment.y * tileSize, tileSize, tileSize));

            ctx.fillStyle = "red";
            ctx.fillRect(food.x * tileSize, food.y * tileSize, tileSize, tileSize);
        }

        function gameLoop() {
            update();
            draw();
        }
    </script>
</body>
</html>
